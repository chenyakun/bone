<!DOCTYPE html>
<html>
<head lang="en">
<meta charset="UTF-8">
	<title>

    </title>
<script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>

</head>
<body>

<script>
	$(function(){
		// insert you code 

		// ajax  & promise
		$.ajax({
			url: "http://localhost:9365/data"
		})
		// deferred.then(doneFilter [, failFilter] [, progressFilter])
		.then(
			// done
			function(response){
				console.info(response);	
			},
			// fail
			function(response){
				console.log('get failed');
			},
			// progress
			function(response){
				console.log('get in progress');
				// console.info(response);	
			}
		).then(function(){
			console.log('the end');
		});
		

		// state
		var deferred = $.Deferred();
		var state = deferred.state();
		console.log(state)

		// state = deferred.resolve().state();
		// console.log(state)

		state = deferred.reject().state();
		console.log(state)


		var deferred = $.Deferred();
		// done & resolve
		deferred.done(function(value){
			console.log(value);
		}).resolve("hello world");

		// always
		$.Deferred()
			.done(function(){console.log(1)})
			.fail(function(){console.log(2)})
			.always(function(){console.log(3)})
			// .resolve()
			// .reject()
			;
		

		// notify & progress

		var userProgress = $.Deferred(),
			count = 0;

		userProgress.progress(function(signal) {
			console.log('receive signal:' + signal)
			console.log('on progress:'+ ++count);
		});

		userProgress.done(function(command) {
			console.log(command+'->done.!');
		});

		userProgress.notify('green');
		userProgress.notify('green');
		userProgress.notify('green');
		userProgress.notify('yellow');
		userProgress.notify('red');
		userProgress.resolve('the end.');

		$.ajax("http://localhost:9365/data?foo=1", {dataType: "json"})
		.then(function( data ){
			console.log(data);
			return $.ajax("http://localhost:9365/data", 
				{ 
					data:{
						"bar":3,
						"uid":197723712306688
					}
				});
		})
		.done(function( data ){
			// url2 data
			console.log(data);
		});
		

		var d = $.Deferred();
		d.then(function() {
			// throw new Error('err');
		}).fail(function() {
			console.log('fail');
		});

		d.resolve();

		// when & then
		var d1 = $.Deferred();

		var promise = $.when('Hello').then(function(h){
			// double shoot
			return $.when(h, d1);	
		});

		// double both ok
		promise.done(function(s1,s2){
			console.log(s1);
			console.log(s2);
		});
		
		console.log('debug use');
		// d1.resolve();


		$.wait = function(time) {
			var dfd = $.Deferred();
			setTimeout(dfd.resolve,time);
			return dfd;
		}

		$.wait(5000).then(function(){
			console.log('from future');
		});
	});
</script>

</body>
</html>
